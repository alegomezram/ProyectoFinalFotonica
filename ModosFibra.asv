clc, close all, clear all

%Parámetros
%Todas las unidades en um
lambda=1;               %longitud de onda
k0=2*pi/lambda;         %numero de onda
a=4.1;                  %radius in um
n1=1.4568527308462205;  %core (germanio)
n2=1.450417399464332;   %cladding (sílice)

% syms beta
% q1=sqrt((n1^2)*(k0^2)-(beta^2));
% q2=sqrt((beta^2)-(n2^2)*(k0^2));
% 
% j2=besselj(2,q1*a);
% j1=besselj(0,q1*a);
% k2=besselk(2,q2*a);
% k1=besselk(1,q2*a);
% 
% f=q1.*(j2./j1)-q2.*(k2./k1);

% Plot
x=linspace(0.25,1.2,20);
y=[1.1621264112771685 1.2127439270702591 1.2534355708765392 1.284212281590459 1.3071649934951726 ... 
    1.3244183401266998 1.3375932313128533 1.3478325179385868 1.3559284594054222 1.362433238041437 ...
1.367737017371117 1.3721200610699893 1.3757871308930476 1.3788903114021598 1.38154434303737 ...
1.3838370784388538 1.385836726758082 1.3875969520958764 1.3891605166328782 1.3905619218694452];
y=[1.1621264112931426 1.21274392709108 1.2534355709026999 1.284212281622229 1.3071649935329228 ...
1.324418340170926 1.337593231364173 1.3478325179977662 1.3559284594733634 1.362433238119182 ...
1.367737017459864 1.37212006117111061.375787131008108
0.9 1.378890311532942
0.9500000000000001 1.381544343185922
1 1.3838370786075118
1.05 1.3858367269495293
1.1 1.3875969523132037
1.1500000000000001 1.3891605168796417
1.2000000000000002 1.3905619221497467

figure('Name','Modos TE'), plot(x,y,'LineWidth',1.5), grid on
legend('R','S','Location','best')
title('Modos TE pares')
xlabel('beta [rad]') 
ylabel('R(θ),S(θ)')

% Método de Newton para hallar las soluciones (intersecciones de las gráficas)
% df = diff(f)
% f=@(beta) (sqrt((n1^2)*(k0^2)-(beta.^2))).*((besselj(2,(sqrt((n1^2)*(k0^2)-(beta.^2)))*a))./(besselj(1,(sqrt((n1^2)*(k0^2)-(beta.^2)))*a)))-(sqrt((beta.^2)-(n2^2)*(k0^2))).*((besselk(2,(sqrt((beta.^2)-(n2^2)*(k0^2)))*a))./(besselk(1,(sqrt((beta.^2)-(n2^2)*(k0^2)))*a)));
% df=@(beta) ((beta^2 - 5844206315499461/70368744177664)^(1/2)*((2*beta*besselk(2, (41*(beta^2 - 5844206315499461/70368744177664)^(1/2))/10))/(beta^2 - 5844206315499461/70368744177664) + (41*beta*besselk(1, (41*(beta^2 - 5844206315499461/70368744177664)^(1/2))/10))/(10*(beta^2 - 5844206315499461/70368744177664)^(1/2))))/besselk(1, (41*(beta^2 - 5844206315499461/70368744177664)^(1/2))/10) - ((1474045368996815/17592186044416 - beta^2)^(1/2)*((41*beta*besselj(1, (41*(1474045368996815/17592186044416 - beta^2)^(1/2))/10))/(10*(1474045368996815/17592186044416 - beta^2)^(1/2)) + (2*beta*besselj(2, (41*(1474045368996815/17592186044416 - beta^2)^(1/2))/10))/(beta^2 - 1474045368996815/17592186044416)))/besselj(0, (41*(1474045368996815/17592186044416 - beta^2)^(1/2))/10) - (beta*besselj(2, (41*(1474045368996815/17592186044416 - beta^2)^(1/2))/10))/((1474045368996815/17592186044416 - beta^2)^(1/2)*besselj(0, (41*(1474045368996815/17592186044416 - beta^2)^(1/2))/10)) - (beta*besselk(2, (41*(beta^2 - 5844206315499461/70368744177664)^(1/2))/10))/((beta^2 - 5844206315499461/70368744177664)^(1/2)*besselk(1, (41*(beta^2 - 5844206315499461/70368744177664)^(1/2))/10)) - ((beta^2 - 5844206315499461/70368744177664)^(1/2)*besselk(2, (41*(beta^2 - 5844206315499461/70368744177664)^(1/2))/10)*((beta*besselk(1, (41*(beta^2 - 5844206315499461/70368744177664)^(1/2))/10))/(beta^2 - 5844206315499461/70368744177664) + (41*beta*besselk(0, (41*(beta^2 - 5844206315499461/70368744177664)^(1/2))/10))/(10*(beta^2 - 5844206315499461/70368744177664)^(1/2))))/besselk(1, (41*(beta^2 - 5844206315499461/70368744177664)^(1/2))/10)^2 - (41*beta*besselj(1, (41*(1474045368996815/17592186044416 - beta^2)^(1/2))/10)*besselj(2, (41*(1474045368996815/17592186044416 - beta^2)^(1/2))/10))/(10*besselj(0, (41*(1474045368996815/17592186044416 - beta^2)^(1/2))/10)^2);
% p0= 10;
% delta=1e-10;
% epsilon=1e-9;
% max=80;
% [c, err, yc] = bisect (f, 9.125, 9.13, delta)
